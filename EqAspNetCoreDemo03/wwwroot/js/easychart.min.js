(function(n){n.widget("eqjs.EasyChart",{_dataTable:null,_dataView:null,_potentialLabelColumns:[],_potentialDataColumns:[],_labelColumn:null,_dataColumns:[],_chartDiv:null,_settingsDiv:null,_ccHeader:"eqjs-chart-header",_ccMain:"eqjs-chart-main",_ccSettings:"eqjs-chart-settings",_ccContent:"eqjs-chart-content",_stateChangedCallback:null,_defaultChartType:10,options:{chartType:this._defaultChartType},_chartTypes:{"3":{name:"Column chart"},"5":{name:"Bar chart"},"6":{name:"Combo chart"},"7":{name:"Area chart"},"9":{name:"Line chart"},"10":{name:"Pie chart",chartAreaWidth:"100%"}},_setOption:function(n,t){return arguments.length==2?(n=="chartType"?this.options.chartType=t&&this._chartTypes.hasOwnProperty(t.toString())?t:this._defaultChartType:this.options[n]=t,this._render(),this):this.options[n]},_create:function(){},_clear:function(){this.element.html("")},init:function(n,t,i){var r=this,u;if(t=t||{dataColumns:[]},this._setOption("chartType",t.chartType||this.options.chartType),r._dataView=null,r._dataTable=n,r._stateChangedCallback=i,r._dataTable){r._potentialLabelColumns=[];r._potentialDataColumns=[];var h=r._dataTable.getNumberOfColumns(),e,o,s=!1,f=[].concat(t.dataColumns);for(u=0;u<h;u++)if(e=r._dataTable.getColumnType(u),o=r._dataTable.getColumnLabel(u),e=="string")r._potentialLabelColumns.push({idx:u,label:o}),t.labelColumn==u&&(s=!0);else if(e=="number")for(r._potentialDataColumns.push({idx:u,label:o});f.indexOf(u)>=0;)f.splice(f.indexOf(u),1);r._potentialLabelColumns.length>0&&(r._labelColumn=s?t.labelColumn:r._potentialLabelColumns[0].idx);r._potentialDataColumns.length>0&&(r._dataColumns=t.dataColumns.length>0&&f.length==0?[].concat(t.dataColumns):[].concat(r._potentialDataColumns[0].idx));r._labelColumn!=null&&r._dataColumns&&r._dataColumns.length>0&&(r._dataView=new google.visualization.DataView(this._dataTable),r._updateChartColumns())}this.refresh()},_updateChartColumns:function(){this._dataView&&this._dataView.setColumns([].concat(this._labelColumn).concat(this._dataColumns))},refresh:function(){this._render()},resize:function(){this._render()},_render:function(){var t=this,f,e,o,s;this._clear();var u=n("<div><\/div>").addClass(t._ccHeader),i=n("<div><\/div>").addClass(t._ccMain),r=n("<select><\/select>");for(f in this._chartTypes)e=this._chartTypes[f],o=n("<option />",{value:f,text:e.name}),o.appendTo(r);r.val(this.options.chartType);r.appendTo(u);r.change(function(){var i=n(this).val();t.options.chartType=parseInt(i);t.refresh();t._onStateChanged()});this._settingsDiv=n("<div><\/div>").addClass(this._ccSettings).hide().appendTo(i);this._chartDiv=n("<div><\/div>").addClass(this._ccContent).hide().appendTo(i).fadeIn(1e3);this._initSettingsDiv();this._dataView!=null?(s=n("<div><\/div>").addClass("eqjs-chart-settings-icon").attr("title","Settings").appendTo(u),s.click(function(){t._toggleSettings()}),t._redrawTwice()):n("<div><\/div>").addClass("eqjs-chart-no-data").text("No Data").appendTo(i);this.element.append(u);this.element.append(i)},_toggleSettings:function(n){var t,i;this._chartDiv.is(":visible")?(t=this._chartDiv,i=this._settingsDiv):(t=this._settingsDiv,i=this._chartDiv);t.fadeToggle({duration:200,complete:function(){i.fadeToggle({duration:200,complete:n})}})},_initSettingsDiv:function(){var t=this,u,i,f,r;n("<div><\/div").text("SETTINGS").addClass(this._ccSettings+"-header").appendTo(this._settingsDiv);u=n("<div><\/div").addClass(this._ccSettings+"-single").appendTo(this._settingsDiv);n("<span><\/span>").text("Label column: ").css({display:"inline-block"}).appendTo(u);i=n("<select><\/select>").css({display:"inline-block"}).appendTo(u);this._potentialLabelColumns.forEach(function(t){var r=n("<option />",{value:t.idx,text:t.label});r.appendTo(i)});i.val(this._labelColumn);i.change(function(){t._labelColumn=parseInt(n(this).val());t._updateChartColumns();t._toggleSettings(function(){t._redrawTwice();t._onStateChanged()})});f=n("<div><\/div").addClass(this._ccSettings+"-single").appendTo(this._settingsDiv);n("<span><\/span>").text("Data column: ").css({display:"inline-block"}).appendTo(f);r=n("<select><\/select>").css({display:"inline-block"}).appendTo(f);this._potentialDataColumns.forEach(function(t){var i=n("<option />",{value:t.idx,text:t.label});i.appendTo(r)});r.val(this._dataColumns[0]);r.change(function(){t._dataColumns[0]=parseInt(n(this).val());t._updateChartColumns();t._toggleSettings(function(){t._redrawTwice();t._onStateChanged()})})},redraw:function(){if(this._dataView!=null){var n={width:"100%",height:"100%",chartArea:{width:this._chartTypes[this.options.chartType.toString()].chartAreaWidth||"50%"}},t=this._createChart(this._chartDiv.get(0));t.draw(this._dataView,n)}},_redrawTwice:function(){var n=this;n.redraw();setTimeout(function(){n.redraw()},200)},_createChart:function(n){switch(this.options.chartType){case 3:return new google.visualization.ColumnChart(n);case 4:return new google.visualization.Histogram(n);case 5:return new google.visualization.BarChart(n);case 6:return new google.visualization.ComboChart(n);case 7:return new google.visualization.AreaChart(n);case 9:return new google.visualization.LineChart(n);case 10:return new google.visualization.PieChart(n);case 17:return new google.visualization.Gauge(n);case 18:return new google.visualization.CandlestickChart(n);default:return new google.visualization.PieChart(n)}},_onStateChanged:function(){if(this._stateChangedCallback){var n={};n.chartType=this.options.chartType;n.labelColumn=this._labelColumn;n.dataColumns=[].concat(this._dataColumns);this._stateChangedCallback(n)}}})})(jQuery);